<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{ base :: common_header(~{::title},~{::link}) }"></head>
<link href="/css/sidebar.css" rel="stylesheet">
<body>
    <input class="theme" id="light-theme" type="radio" checked="checked" style="display: none"/>
    <input class="theme" id="dark-theme" type="radio" style="display: none"/>

    <main>
        <div class="sidebar">
            <h3>Menu</h3>

            <nav class="menu">
                <div class="menu-item is-active">
                    <i class="fa-solid fa-wand-magic-sparkles"></i>
                    <span>Generator</span>
                </div>

                <div class="menu-item">
                    <i class="fa-solid fa-floppy-disk"></i>
                    <span>Saved Dialogues</span>
                </div>

                <div class="menu-item">
                    <i class="fa-solid fa-user"></i>
                    <span>Logout</span>
                </div>
            </nav>

            <div class="form-check form-switch d-flex align-items-center">
                <label for="theme-switch" class="form-check-label me-5">Theme Switch</label>
                <input class="form-check-input" type="checkbox" role="switch" id="theme-switch">
            </div>
        </div>

        <div class="content">
            <h1>Welcome, Human</h1>
            <p>This is homepage</p>

            <br>
            <br>
            <br>
            <br>
            <br>

            <section class="form">
                <h1>Generate Dialogue</h1>

                <form class="prompt-form">
                    <div class="form-group">
                        <label for="game-context">Describe the Game Context:</label>
                        <textarea class="form-control" id="game-context" rows="5"
                                  placeholder="Describe the game setting, world history, main conflict or goals, key events... (200 words)"></textarea>
                    </div>
                    <div class="form-inline form-group">
                        <label for="genre-dropdown">Pick a Genre:</label>
                        <select class="form-select form-control dropdown-toggle" id="genre-dropdown"></select>
                    </div>
                    <div class="form-group">
                        <label for="tone-description">Describe the Tone:</label>
                        <textarea class="form-control" id="tone-description" rows="2"
                                  placeholder="lively, despair, tense, suspenseful, ..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="add-character">Describe your Characters</label>
                        <button type="button" class="button" id="add-character" onclick="addCharacter()">Add Character</button>
                        <div id="character-container">
                            <label id="labelcharacter1" for="textcharacter1">Character 1</label>
                            <textarea class="form-control" id="textcharacter1" rows="3"
                                      placeholder="Describe the character's role, personality, relationship with other characters ..."></textarea>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col form-inline form-group">
                            <label for="max-dialogue-depth">Maximum Dialogue Depth:</label>
                            <select class="form-select form-control dropdown-toggle" id="max-dialogue-depth" >
                                <option>1</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5</option>
                            </select>
                        </div>
                        <div class="col form-inline form-group">
                            <label for="num-endings">Number of Endings:</label>
                            <select class="form-select form-control dropdown-toggle" id="num-endings">
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5</option>
                            </select>
                        </div>
                        <div class="col form-inline form-group">
                            <label for="language-dropdown">Pick a Language:</label>
                            <select class="form-select form-control dropdown-toggle" id="language-dropdown"></select>
                        </div>
                    </div>
                    <button type="button" class="button" onclick="sendPrompt()">Generate</button>
                </form>
            </section>
        </div>
    </main>
</body>

<script>
    $("#theme-switch").on("click", function() {
        if ($(this).prop('checked')) {
            $("#light-theme").prop("checked", false);
            $("#dark-theme").prop("checked", true);
            $("body").css("background", "#2F2E2E");
            $("footer").attr("class", "dark");
        } else {
            $("#dark-theme").prop("checked", false);
            $("#light-theme").prop("checked", true);
            $("body").css("background", "#f9f9f9");
            $("footer").attr("class", "");
        }
    });

    function getGenres() {
        axios.get('/genres')
            .then(function (response) {
                const genres = response.data.data;
                const genreDropdown = document.getElementById('genre-dropdown');
                genres.forEach(function (genre) {
                    const option = document.createElement('option');
                    option.value = genre.genreid;
                    option.textContent = genre.name;
                    genreDropdown.appendChild(option);
                });
            })
            .catch(function (error) {
                console.log(error.response.data);
            });
    }

    function getLanguages() {
        axios.get('/languages')
            .then(function (response) {
                const languages = response.data.data;
                const languageDropdown = document.getElementById('language-dropdown');
                languages.forEach(function (language) {
                    const option = document.createElement('option');
                    option.value = language.languageid;
                    option.textContent = language.name;
                    languageDropdown.appendChild(option);
                });
            })
            .catch(function (error) {
                console.log(error.response.data);
            });
    }

    function sendPrompt() {
    //     TODO: Send information to backend
    }

    let characterCount = 1;
    function addCharacter() {
    //     Dynamically adds another character text box
        characterCount += 1;
        let newLabel = document.createElement("label");
        newLabel.setAttribute("for", "textcharacter"+characterCount);
        newLabel.setAttribute("id", "labelcharacter"+characterCount);
        newLabel.textContent = "Character " + characterCount;

        let newTextarea = document.createElement("textarea");
        newTextarea.setAttribute("class", "form-control");
        newTextarea.setAttribute("id", "textcharacter"+characterCount);
        newTextarea.setAttribute("rows", "3");
        newTextarea.setAttribute("placeholder",
            "Describe the character's role, personality, relationship with other characters ...");

        let deleteButton = document.createElement("button");
        deleteButton.setAttribute("type", "button");
        deleteButton.setAttribute("class", "button");
        deleteButton.setAttribute("id", "delete-button"+characterCount);
        deleteButton.textContent = "Delete Character";
        deleteButton.onclick = function() {
            deleteCharacter(deleteButton.id);
        };

        let container = document.getElementById("character-container");
        container.appendChild(newLabel);
        container.appendChild(deleteButton);
        container.appendChild(newTextarea);

        // Limit the number of characters
        if (characterCount >= 4) {
            let button = document.getElementById("add-character");
            button.disabled = true;
        }
    }

    function deleteCharacter(buttonId) {
    //     Deletes a character text box
        let id = buttonId.slice(-1);
        let container = document.getElementById("character-container");
        container.removeChild(document.getElementById("labelcharacter"+id));
        container.removeChild(document.getElementById("textcharacter"+id));
        container.removeChild(document.getElementById("delete-button"+id));

        characterCount -= 1;

        let button = document.getElementById("add-character");
        button.disabled = false;

        updateCharacters();
    }

    function updateCharacters() {
        //     Update the Character numberings
        let labels = document.querySelectorAll('[id^="labelcharacter"]');
        let textareas = document.querySelectorAll('[id^="textcharacter"]');
        let deleteButtons = document.querySelectorAll('[id^="delete-button"]');

        for (let i = 0; i < labels.length; i++) {
            labels[i].setAttribute("for", "textcharacter"+(i+1));
            labels[i].setAttribute("id", "labelcharacter"+(i+1));
            labels[i].textContent = "Character " + (i+1);

            textareas[i].setAttribute("id", "textcharacter"+(i+1));
        }

        for (let i = 0; i < deleteButtons.length; i++) {
            deleteButtons[i].setAttribute("id", "delete-button"+(i+2));
            deleteButtons[i].onclick = function () {
                deleteCharacter(deleteButtons[i].id);
            };
        }
    }

    window.onload = function() {
        getGenres();
        getLanguages();
    };
</script>
</html>
